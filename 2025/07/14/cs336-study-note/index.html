

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/ucas.webp">
  <link rel="icon" href="/img/ucas.webp">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Munger Yang">
  <meta name="keywords" content="">
  
    <meta name="description" content="CS336: Language Modeling from Scratch      Stanford &#x2F; Spring 2025      å­¦ä¹ ç¬”è®°æ•´ç†ï¼šæ¨æ¡‚æ·¼     è¯¾ç¨‹ä¸»é¡µï¼šhttps:&#x2F;&#x2F;stanford-cs336.github.io&#x2F;spring2025&#x2F;   GoalThis course is designed to provide students with a comp">
<meta property="og:type" content="article">
<meta property="og:title" content="cs336:Language Modeling from Scratch">
<meta property="og:url" content="http://example.com/2025/07/14/cs336-study-note/index.html">
<meta property="og:site_name" content="mungerå†™å­—çš„åœ°æ–¹">
<meta property="og:description" content="CS336: Language Modeling from Scratch      Stanford &#x2F; Spring 2025      å­¦ä¹ ç¬”è®°æ•´ç†ï¼šæ¨æ¡‚æ·¼     è¯¾ç¨‹ä¸»é¡µï¼šhttps:&#x2F;&#x2F;stanford-cs336.github.io&#x2F;spring2025&#x2F;   GoalThis course is designed to provide students with a comp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://stanford-cs336.github.io/spring2025/images/stanford-nlp-logo-new.jpg">
<meta property="article:published_time" content="2025-07-14T02:40:26.000Z">
<meta property="article:modified_time" content="2025-07-25T09:13:32.800Z">
<meta property="article:author" content="Munger Yang">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="æ·±åº¦å­¦ä¹ ">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://stanford-cs336.github.io/spring2025/images/stanford-nlp-logo-new.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>cs336:Language Modeling from Scratch - mungerå†™å­—çš„åœ°æ–¹</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":75,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Munger Yang&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about" target="_self">
                <i class="iconfont icon-addrcard"></i>
                <span>ä¸»é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>åšå®¢</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/" target="_self">
                    <i class="iconfont icon-pen"></i>
                    <span>æ–‡ç« </span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/" target="_self">
                    <i class="iconfont icon-archive-fill"></i>
                    <span>æ€»è§ˆ</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/" target="_self">
                    <i class="iconfont icon-category-fill"></i>
                    <span>åˆ†ç±»</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/" target="_self">
                    <i class="iconfont icon-tags-fill"></i>
                    <span>æ ‡ç­¾</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/picture" target="_self">
                <i class="iconfont icon-image"></i>
                <span>ç…§ç‰‡å¢™</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/self/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>ç®€å†</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>å‹é“¾</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg/paper.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="cs336:Language Modeling from Scratch"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-14 10:40" pubdate>
          2025å¹´7æœˆ14æ—¥ ä¸Šåˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.7k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          15 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">cs336:Language Modeling from Scratch</h1>
            
            
              <div class="markdown-body">
                
                <center>
  <h1>CS336: Language Modeling from Scratch</h1>
</center>

<center>
  <h1>Stanford / Spring 2025</h1>
</center>

<center>
  å­¦ä¹ ç¬”è®°æ•´ç†ï¼šæ¨æ¡‚æ·¼
</center>
<center>
  è¯¾ç¨‹ä¸»é¡µï¼šhttps://stanford-cs336.github.io/spring2025/
</center>

<h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>This course is designed to provide students with a comprehensive understanding of language models by walking them through the entire process of developing their own. Drawing inspiration from operating systems courses that create an entire operating system from scratch, we will lead students through every aspect of language model creation, including data collection and cleaning for pre-training, transformer model construction, model training, and evaluation before deployment.</p>
<p><img src="https://stanford-cs336.github.io/spring2025-lectures/images/design-decisions.png" srcset="/img/loading.gif" lazyload alt="design-decisions"></p>
<h2 id="Tokenization"><a href="#Tokenization" class="headerlink" title="Tokenization"></a>Tokenization</h2><p>Tokenizersæ˜¯å°†å­—ç¬¦ä¸²å’Œæ•´æ•°åºåˆ—ä¹‹é—´è¿›è¡Œç›¸äº’è½¬æ¢ï¼Œå››ç±»ä¸»è¦çš„åˆ†è¯å™¨ï¼šcharacter_tokenizerã€byte_tokenizerã€word_tokenizerã€bpe_tokenizerã€‚</p>
<p><img src="https://stanford-cs336.github.io/spring2025-lectures/images/tokenized-example.png" srcset="/img/loading.gif" lazyload alt="Tokenization"></p>
<p>character_tokenizerï¼šæ¯ä¸ªå­—ç¬¦å¯ä»¥é€šè¿‡<code>ord</code>å‡½æ•°å®Œæˆå­—ç¬¦åˆ°ASCIIç (Unicode)çš„ç›¸äº’è½¬æ¢ã€‚ä½†æ˜¯å¸¦æ¥çš„é—®é¢˜å°±æ˜¯æ„æˆçš„è¯è¡¨éå¸¸å¤§ï¼Œè®¸å¤šå­—ç¬¦ç”Ÿåƒ»å°‘ç”¨å¯¼è‡´è¯æ±‡ä½¿ç”¨æ•ˆç‡ä½ã€‚</p>
<p>byte_tokenizerï¼šUnicodeå­—ç¬¦å¯ä»¥è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªä½¿ç”¨0-255æ•´æ•°è¡¨ç¤ºçš„<strong>å­—èŠ‚åºåˆ—</strong>ã€‚ä½†æ˜¯ç”±äºä¸€ä¸ªå­—èŠ‚åªèƒ½è¢«256ä¸ªæ•´æ•°æ‰€è¡¨ç¤ºï¼Œè¿™å°±é€ æˆäº†ç»è¿‡Tokenizationåçš„åºåˆ—é•¿åº¦ä¼šå˜å¾—éå¸¸é•¿ã€‚</p>
<p>word_tokenizerï¼šNLPé¢†åŸŸå†…å¸¸ç”¨çš„æ–¹æ³•æ˜¯å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºå•è¯ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ„å»ºåˆ†è¯å™¨ï¼Œå°†åŸºäºåˆ†è¯å™¨å¾—åˆ°çš„segmentsæ˜ å°„ä¸ºæ•´æ•°ï¼Œæ„å»ºå‡ºæ¯ä¸ªsegmentçš„æ•´æ•°æ˜ å°„ã€‚ä½†æ˜¯å­˜åœ¨çš„é—®é¢˜æ˜¯å•è¯çš„æ•°é‡å·¨å¤§ï¼Œæ— æ³•æä¾›å›ºå®šçš„è¯æ±‡é‡ï¼›è®­ç»ƒæœŸé—´æœªä½¿ç”¨è¿‡çš„æ–°è¯ä¼šè¢«æ ‡è®°ä¸ºUNKï¼Œæ‰°ä¹±å›°æƒ‘åº¦è®¡ç®—ã€‚</p>
<p>ğŸ’¡è”æƒ³è¯­è¨€æ¨¡å‹çš„è¾“å‡ºï¼šLLMçš„è¾“å‡ºæœ¬è´¨ä¸Šå°±æ˜¯åœ¨ä¸€ä¸ªå¤§çš„è¯è¡¨ä¸Šé¢„æµ‹å•è¯çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå¦‚æœè¯è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆè®¡ç®—äº†å¯æƒ³è€ŒçŸ¥æ˜¯éå¸¸ææ€–çš„ï¼Œè€Œä¸”ä¹Ÿä¼šå½±å“tokençš„é¢„æµ‹ã€‚ä¸Šé¢ä»‹ç»çš„ä¸‰ç§Tokenizationéƒ½å„æœ‰ç‰¹ç‚¹ï¼Œä½†æ˜¯ä¹Ÿéƒ½å­˜åœ¨è‡´å‘½çš„ç¼ºç‚¹ã€‚LLMåŸºäºä¸Šè¿°ç¼–ç çš„åŠ£åŠ¿ï¼Œæœ€ç»ˆé€‰æ‹©é‡‡ç”¨BPEç®—æ³•ä½œä¸ºæ¨¡å‹çš„Tokenizationæ–¹æ³•ã€‚</p>
<h3 id="Byte-Pair-Encoding"><a href="#Byte-Pair-Encoding" class="headerlink" title="Byte Pair Encoding"></a>Byte Pair Encoding</h3><p>BPEç®—æ³•æ˜¯åœ¨1994å¹´å‘è¡¨çš„â€œA New Algorithm for Data Compressionâ€æå‡ºçš„ä¸€ç§æ–°å‹<strong>æ•°æ®å‹ç¼©</strong>ç®—æ³•ã€‚æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†åºåˆ—ä¸­å¸¸è§çš„ä¸€å¯¹<strong>ç›¸é‚»çš„æ•°æ®å•å…ƒ</strong>æ›¿æ¢ä¸ºæ•°æ®ä¸­æ²¡æœ‰å‡ºç°è¿‡çš„æ–°å•å…ƒï¼Œåå¤è¿­ä»£ç›´è‡³æ»¡è¶³ç»ˆæ­¢æ¡ä»¶ã€‚</p>
<p>bpe_tokenizerï¼šåŸºæœ¬æ€è·¯æ˜¯å¸¸è§çš„å­—ç¬¦åºåˆ—è¢«å•ä¸ªtokenè¡¨ç¤ºï¼Œç½•è§çš„åºåˆ—è¢«å¤šä¸ªtokensè¡¨ç¤ºã€‚</p>
<p>BPEçš„åŸºæœ¬è®¡ç®—è·¯ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/img/fig/bpe.jpg" srcset="/img/loading.gif" lazyload/>





<h2 id="Pytorch-and-Resource-accounting"><a href="#Pytorch-and-Resource-accounting" class="headerlink" title="Pytorch and Resource accounting"></a>Pytorch and Resource accounting</h2><h3 id="tensors-memory"><a href="#tensors-memory" class="headerlink" title="tensors_memory"></a>tensors_memory</h3><p>Higher precision: more accurate&#x2F;stable, more memory, more compute</p>
<p>Lower precision: less accurate&#x2F;stable, less memory, less compute</p>
<ul>
<li>float32ï¼šå•ç²¾åº¦æµ®ç‚¹æ•°æ˜¯tensorçš„é»˜è®¤æ•°æ®ç±»å‹ï¼Œ4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°ã€‚1ä½ç¬¦å·ä½ï¼Œ 8ä½æŒ‡æ•°ä½ï¼Œ 23ä½å°æ•°ä½ã€‚ç¥ç»ç½‘ç»œè®­ç»ƒæ—¶ï¼Œåˆ›å»ºtensoré»˜è®¤çš„æ•°æ®ç±»å‹ã€‚</li>
</ul>
<p>å½“ç¬¦å·ä½ä¸º0ï¼ŒæŒ‡æ•°ä½ä¸º11111110ï¼Œå°¾æ•°ä½ä¸ºå…¨1æ—¶ï¼Œfloat32çš„æœ€å¤§å€¼ä¸º $2^{127} \times (1+\frac{2^{23}-1}{2^{23}}&#x3D;3.40e38$ï¼›</p>
<p>å½“ç¬¦å·ä½ä¸º1ï¼ŒæŒ‡æ•°ä½ä¸º11111110ï¼Œå°¾æ•°ä½ä¸ºå…¨1æ—¶ï¼Œfloat32çš„æœ€å°å€¼ä¸º$-2^{127} \times (1+\frac{2^{23}-1}{2^{23}}&#x3D;-3.40e38$ã€‚</p>
<ul>
<li>float16ï¼šåŠç²¾åº¦æµ®ç‚¹æ•°ï¼Œä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°ã€‚1ä½ç¬¦å·ä½ï¼Œ 5ä½æŒ‡æ•°ä½ï¼Œ 10ä½å°æ•°ä½ã€‚ç›¸æ¯”äºfloat32æ‰€å å†…å­˜æ›´å°ï¼Œä½†æ˜¯ä¼šå‡ºç°<strong>æº¢å‡ºé—®é¢˜</strong>ã€‚</li>
</ul>
<p>å½“ç¬¦å·ä½ä¸º0ï¼ŒæŒ‡æ•°ä½ä¸º11110ï¼Œå°¾æ•°ä½ä¸ºå…¨1æ—¶ï¼Œfloat16çš„æœ€å¤§å€¼ä¸º $2^{15} \times (1+\frac{1023}{1024})&#x3D;65504$ï¼›</p>
<p>å½“ç¬¦å·ä½ä¸º1ï¼ŒæŒ‡æ•°ä½ä¸º11110ï¼Œå°¾æ•°ä½ä¸ºå…¨1æ—¶ï¼Œfloat16çš„æœ€å°å€¼ä¸º$-2^{15} \times (1+\frac{1023}{1024}) &#x3D; -65504$ã€‚</p>
<ul>
<li>bfloat16ï¼šä¸float16æ‰€å å†…å­˜ä¸€è‡´ï¼Œä½†æ˜¯å…·æœ‰float32çš„å­˜å‚¨èŒƒå›´ã€‚1ä½ç¬¦å·ä½ï¼Œ 8ä½æŒ‡æ•°ä½ï¼Œ 7ä½å°æ•°ä½ã€‚</li>
</ul>
<p>è®¡ç®—<code>çŸ©é˜µä¹˜æ³•</code>ä¸<code>å‰å‘ä¼ æ’­</code>æ—¶æ¨èä½¿ç”¨bfloat16æ•°æ®ç±»å‹ï¼Œè®¡ç®—<code>Attentionæ³¨æ„åŠ›</code>æ—¶æ¨èä½¿ç”¨float32æ•°æ®ç±»å‹ã€‚</p>
<p>æŒ‡æ•°çš„åç½®ï¼š</p>
<ul>
<li><code>float32</code> çš„ Bias ä¸º 127</li>
<li><code>float16</code> çš„ Bias ä¸º 15</li>
<li><code>bfloat16</code> çš„ Bias ä¸º 127</li>
</ul>
<p><img src="https://githubraw.cdn.bcebos.com/PaddlePaddle/docs/develop/docs/guides/performance_improving/images/float.png?raw=true" srcset="/img/loading.gif" lazyload alt="FLOPS"></p>
<p>è®¡ç®—å®ä¾‹å¦‚ä¸‹ï¼Œä»¥float16ä¸ºä¾‹ï¼š</p>
<img src="/img/fig/float16.jpg" srcset="/img/loading.gif" lazyload/>

<h3 id="tensors-on-gpus"><a href="#tensors-on-gpus" class="headerlink" title="tensors_on_gpus"></a>tensors_on_gpus</h3><p>ä¸ºäº†åˆ©ç”¨å¥½GPUsçš„å¹¶è¡Œä¼˜åŠ¿ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®ä»CPUä¸­çš„RAMç§»åŠ¨åˆ°GPUä¸­çš„DRAMä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> torch.cuda.is_available():<br>  <span class="hljs-keyword">return</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_gpus):<br>  properties = torch.cuda.get_device_properties(i)  <span class="hljs-comment"># @inspect properties</span><br> <br>y = x.to(<span class="hljs-string">&quot;cuda:0&quot;</span>)<br><span class="hljs-keyword">assert</span> x.device == torch.device(<span class="hljs-string">&quot;cuda&quot;</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>

<p>PyTorchä¸­çš„tensorså°±æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆï¼Œå­˜å‚¨å½¢å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://stanford-cs336.github.io/spring2025-lectures/var/files/image-97aa05a6701b46521cb8a7c1e096c7e7-https_martinlwx_github_io_img_2D_tensor_strides_png" srcset="/img/loading.gif" lazyload alt="tensor-pointer"></p>
<p>strides[1]è¡¨ç¤ºåˆ—æŒ‡é’ˆï¼Œstrides[0]è¡¨ç¤ºè¡ŒæŒ‡é’ˆï¼›ä¸Šå›¾ä¸­äºŒç»´æ ¼å¼ä¸ºæˆ‘ä»¬ä¹ æƒ¯ä¸Šç”»å‡ºçš„å­˜å‚¨æ ¼å¼ï¼Œä½†æ˜¯åœ¨å†…å­˜æ¡ä¸­å­˜å‚¨çš„æ ¼å¼æœ¬è´¨ä¸Šæ˜¯ä¸‹å›¾ä¸­çš„çº¿æ€§æ ¼å¼ã€‚å¦‚æœè¦å®šä½ä¸€ä¸ªå…ƒç´ çš„ä½ç½®(æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ )ï¼Œéœ€è¦åˆ©ç”¨è¿ä¸ªæŒ‡é’ˆè¿›è¡Œè¾…åŠ©ï¼š$pos&#x3D;1 * strides[1] + 4 * strides[0]$ã€‚</p>
<p>ä»¥å…ƒç´ 10ä¸ºä¾‹(2è¡Œ3åˆ—)ï¼Œ$pos_{10}&#x3D;1 * 3 + 4 * 2 &#x3D; 11$ï¼Œé‚£ä¹ˆå†…å­˜ä¸­æ¨ªå‘ç¬¬11ä¸ªä½ç½®(ä»1è®¡æ•°)å¯¹åº”çš„å…ƒç´ å³æ˜¯10ã€‚</p>
<h3 id="tensor-operations"><a href="#tensor-operations" class="headerlink" title="tensor_operations"></a>tensor_operations</h3><p>Pytorchå¯¹äºtensorçš„æ“ä½œä¸­ï¼Œ<code>view</code>æ˜¯freeï¼Œæ— é¡»å ç”¨å†…å­˜ï¼›ä½†æ˜¯copyæ“ä½œ(<code>contiguous and reshape</code>)æ˜¯éœ€è¦å†…å­˜å¼€é”€çš„ã€‚</p>
<p>âš ï¸<strong>einops</strong>æ˜¯ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡çš„æ“ä½œï¼Œä¸»è¦ä½œç”¨æ˜¯é«˜æ•ˆæ“ä½œå¼ é‡çš„ç»´åº¦ï¼Œéœ€è¦ç•™å¿ƒå­¦ä¹ å…³æ³¨ä¸‹ã€‚æ¨èä¸€ç¯‡åšæ–‡ï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/342675997">https://zhuanlan.zhihu.com/p/342675997</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># çŸ©é˜µä¹˜æ³•</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tensor_matmul</span>():<br>  x = torch.ones(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>)<br>  w = torch.ones(<span class="hljs-number">32</span>, <span class="hljs-number">2</span>)<br>  <br>y = x @ w<br><span class="hljs-keyword">assert</span> y.size() == torch.Size([<span class="hljs-number">16</span>, <span class="hljs-number">2</span>])<br><br><span class="hljs-comment"># å®šä¹‰ä¸¤ä¸ªå¼ é‡:</span><br>x: Float[torch.Tensor, <span class="hljs-string">&quot;batch seq1 hidden&quot;</span>] = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)  <span class="hljs-comment"># @inspect x</span><br>y: Float[torch.Tensor, <span class="hljs-string">&quot;batch seq2 hidden&quot;</span>] = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)  <span class="hljs-comment"># @inspect y</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tensor_einops</span>():<br>  <span class="hljs-comment">#einopsä¸»è¦æ˜¯rearrange, reduce, repeatè¿™3ä¸ªæ–¹æ³•</span><br>  z = x @ y.transpose(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)  <span class="hljs-comment"># batch, sequence, sequence  @inspect z --&gt; Old way</span><br>  z = einsum(x, y, <span class="hljs-string">&quot;batch seq1 hidden, batch seq2 hidden -&gt; batch seq1 seq2&quot;</span>)  <span class="hljs-comment"># @inspect z --&gt; New (einops) way</span><br>  z = einsum(x, y, <span class="hljs-string">&quot;... seq1 hidden, ... seq2 hidden -&gt; ... seq1 seq2&quot;</span>)  <span class="hljs-comment"># @inspect z</span><br>  <span class="hljs-comment"># reduce</span><br>  x: Float[torch.Tensor, <span class="hljs-string">&quot;batch seq hidden&quot;</span>] = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)  <span class="hljs-comment"># @inspect x</span><br>  y = x.mean(dim=-<span class="hljs-number">1</span>)  <span class="hljs-comment"># @inspect y --&gt; Old way</span><br>  y = reduce(x,<span class="hljs-string">&quot;...hidden -&gt; ...&quot;</span>,<span class="hljs-string">&quot;sum&quot;</span>) --&gt; New (einops) way<br>  <span class="hljs-comment"># rearrange</span><br>  x: Float[torch.Tensor, <span class="hljs-string">&quot;batch seq total_hidden&quot;</span>] = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>)  <span class="hljs-comment"># @inspect x</span><br>  w: Float[torch.Tensor, <span class="hljs-string">&quot;hidden1 hidden2&quot;</span>] = torch.ones(<span class="hljs-number">4</span>,<span class="hljs-number">4</span>)<br>  <br>  x = rearrange(x, <span class="hljs-string">&quot;... (heads hidden1) -&gt; ... heads hidden1&quot;</span>, heads=<span class="hljs-number">2</span>)  <span class="hljs-comment"># @inspect x</span><br>  x = einsum(x, w, <span class="hljs-string">&quot;... hidden1, hidden1 hidden2 -&gt; ... hidden2&quot;</span>)  <span class="hljs-comment"># @inspect x</span><br></code></pre></td></tr></table></figure>

<h3 id="Computational-cost"><a href="#Computational-cost" class="headerlink" title="Computational cost"></a>Computational cost</h3><p>LLMé‡Œçš„è®¡ç®—åŸºæœ¬ä¸Šéƒ½æ˜¯æµ®ç‚¹è¿ç®—(FLOP)ï¼Œç±»ä¼¼äºåŠ æ³•è¿ç®—å’Œä¹˜æ³•è¿ç®—ã€‚</p>
<p>å®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼š</p>
<ul>
<li>FLOPs: æµ®ç‚¹è¿ç®—æ¬¡æ•°</li>
<li>FLOP&#x2F;sï¼šæ¯ç§’é’Ÿæµ®ç‚¹è®¡ç®—æ¬¡æ•°ï¼Œè¡¡é‡ç¡¬ä»¶æŒ‡æ ‡</li>
</ul>
<p>å¯¹ m x n çŸ©é˜µè¿›è¡Œå…ƒç´ è¿ç®—éœ€è¦ O(mn) FLOPsï¼›ä¸¤ä¸ª m x n çŸ©é˜µçš„åŠ æ³•éœ€è¦ mn æ¬¡ FLOPsã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ²¡æœ‰ä»»ä½•è¿ç®—æ¯”çŸ©é˜µä¹˜æ³•æ›´è€—æ—¶ã€‚</p>
<p>æˆ‘ä»¬ç”¨ B è¡¨ç¤ºæ•°æ®ç‚¹çš„ä¸ªæ•°ï¼Œ(D K)æ˜¯å‚æ•°å¤§å°ï¼Œ2 (# tokens) (# parameters)ä»£è¡¨å‰æƒ³ä¼ æ’­çš„FLOPsã€4 (# data points) (# parameters) åå‘ä¼ æ’­FLOPsã€6 (# data points) (# parameters)ä»£è¡¨ä¸€æ¬¡è®­ç»ƒçš„FLOPsã€‚</p>
<p>ä¸€ä¸ªé‡è¦æŒ‡æ ‡ï¼šModel FLOPs utilization - æ¨¡å‹FLOPsåˆ©ç”¨ç‡ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">mfu = actual_flop_per_sec / promised_flop_per_sec  <span class="hljs-comment"># @inspect mfu</span><br></code></pre></td></tr></table></figure>

<p>FLOP&#x2F;så–å†³äºç¡¬ä»¶(H100 &gt;&gt; A100) å’Œæ•°æ®ç±»å‹(bfloat16 &gt;&gt; float32)ã€‚</p>
<h3 id="Parameter-initialization"><a href="#Parameter-initialization" class="headerlink" title="Parameter initialization"></a>Parameter initialization</h3><p>åˆå§‹åŒ–è¯­æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">x = nn.Parameter(torch.randn(input_dim))<br>w = nn.Parameter(nn.init.trunc_normal_(torch.empty(input_dim, output_dim), std=<span class="hljs-number">1</span> / np.sqrt(input_dim), a=-<span class="hljs-number">3</span>, b=<span class="hljs-number">3</span>))<br></code></pre></td></tr></table></figure>

<p>ç»´åº¦ç¼©æ”¾çš„åŸå› ï¼šä¸ºäº†é˜²æ­¢å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­å‘ç”Ÿæ¢¯åº¦çˆ†ç‚¸ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®šï¼›å°†è¾“å…¥è¿›è¡Œ1&#x2F;sqrt(input_dim) ç¼©æ”¾ï¼Œè¿™æ ·æ¯ä¸€æ­¥éƒ½ä¼šå¾—åˆ°åŸºäºæ­£å¤ªåˆ†å¸ƒçš„è¾“å‡ºï¼Œä¿è¯äº†æ•°æ®çš„ç¨³å®šæ€§ã€‚è¿™ä¸ªé“ç†åœ¨æ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—ä¸­åŒæ ·é€‚ç”¨ã€‚</p>
<p>âš ï¸æ•°æ®åŠ è½½çš„æ³¨æ„äº‹é¡¹ï¼šDonâ€™t want to load the entire data into memory at onceï¼å¤§è¯­è¨€æ¨¡å‹çš„è¾“å…¥æ˜¯æ•´æ•°åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨numpyæ•°ç»„åŠ è½½è¿™äº›æ•°æ®ï¼Œä½¿ç”¨memapå»¶è¿ŸåŠ è½½éƒ¨åˆ†æ•°æ®åˆ°å†…å­˜ä¸­ã€‚</p>
<p>optimizerçš„ç»„æˆï¼š</p>
<ul>
<li>momentum &#x3D; SGD + exponential averaging of grad</li>
<li>AdaGrad &#x3D; SGD + averaging by grad$^2$</li>
<li>RMSProp &#x3D; AdaGrad + exponentially averaging of grad$^2$</li>
<li>Adam &#x3D; RMSProp + momentum</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="category-chain-item">äººå·¥æ™ºèƒ½ä¸æ·±åº¦å­¦ä¹ </a>
  
  

      </span>
    
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9B%B8%E5%85%B3/" class="category-chain-item">å¤§æ¨¡å‹ç›¸å…³</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/LLM/" class="print-no-link">#LLM</a>
      
        <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" class="print-no-link">#æ·±åº¦å­¦ä¹ </a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>cs336:Language Modeling from Scratch</div>
      <div>http://example.com/2025/07/14/cs336-study-note/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Munger Yang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2025å¹´7æœˆ14æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/29/Prompt-Compression/" title="Prompt Compression">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Prompt Compression</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/01/2025%E5%B9%B46%E6%9C%88%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B/" title="2025å¹´6æœˆæ€»ç»“ä¸å±•æœ›">
                        <span class="hidden-mobile">2025å¹´6æœˆæ€»ç»“ä¸å±•æœ›</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://registry.npmmirror.com/@waline/client/2.15.8/files/dist/waline.css')
      Fluid.utils.createScript('https://registry.npmmirror.com/@waline/client/2.15.8/files/dist/waline.js', function() {
        var options = Object.assign(
          {"serverURL":"https://comment.mungeryang.top/","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> <script src="/js/duration.js"></script> </div> <a target="_blank" rel="noopener" href="https://www.aliyun.com/">æœ¬ç½‘ç«™ç”±<img src="/img/aliyun.png" srcset="/img/loading.gif" lazyload width="65px" />æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a>
    </div>
  
  
    <div class="statistics">
  
  

  
    
    
    

  
</div>

  
  
    <!-- å¤‡æ¡ˆä¿¡æ¯ ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      äº¬ICPå¤‡2024090304å·
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>äº¬å…¬ç½‘å®‰å¤‡2024090304å·</span>
        </a>
      </span>
    
  
</div>

  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
